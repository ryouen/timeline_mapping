# Google Maps URL構造の完全解析

## 作成日
2025年8月15日

## 正しく動作するURLの必須要素

### 1. Place IDの重要性
住所だけでは不十分。Place IDが必須。

**例：東京アメリカンクラブ日本橋**
- Place ID: `0x60188bffe47b594f:0xf5b2351645635f1e`
- 座標: `35.6879088, 139.772537`

### 2. 完全なURL構造

```
https://www.google.com/maps/dir/
[出発地（郵便番号+住所）]/
[目的地（郵便番号+住所）]/
@[中心座標],16z/
data=!3m1!4b1
!4m17!4m16
!1m5!1m1!1s[出発地Place ID]!2m2!1d[経度]!2d[緯度]
!1m5!1m1!1s[目的地Place ID]!2m2!1d[経度]!2d[緯度]
!2m3!6e1!7e2!8j[タイムスタンプ]
```

### 3. 重要なパラメータ

#### 公共交通機関モード
- **!3e3** - 必須だが、Place IDがあれば自動的に適用される場合もある
- **!3m1!4b1** - 追加のモード指定

#### 時刻指定
- **!6e1** - 到着時刻指定（1=到着、0=出発）
- **!7e2** - 時刻指定有効化
- **!8j[timestamp]** - Unix timestamp（UTC基準の時刻値）

#### 詳細表示
- **/am=t** - 詳細ルート表示モード

### 4. タイムスタンプの特殊仕様

2025年8月16日 10:00 JST到着の場合：
- 期待値: `1755306000`（2025-08-16 01:00 UTC）
- **実際に必要**: `1755338400`（2025-08-16 10:00 UTC）
- Google Mapsはタイムゾーンを無視して時刻値をそのまま使用

### 5. 実例

#### Shizenkan（完全動作確認済み）
```
https://www.google.com/maps/dir/
〒101-0041+東京都千代田区神田須田町１丁目２０−１+吉川ビル/
〒103-6199+東京都中央区日本橋２丁目５−１/
@35.6880527,139.7674084,16z/
data=!4m18!4m17
!1m5!1m1!1s0x60188c02f64e1cd9:0x987c1c7aa7e7f84a!2m2!1d139.7711379!2d35.6949994
!1m5!1m1!1s0x601889d738b39701:0x996fd0bd4cfffd56!2m2!1d139.773935!2d35.6814238
!2m3!6e1!7e2!8j1755338400!3e3
```

結果: 9:48出発 → 9:56到着（銀座線、8分、180円）

#### 東京アメリカンクラブ日本橋（完全動作確認済み）
```
https://www.google.com/maps/dir/
〒101-0041+東京都千代田区神田須田町１丁目２０−１+吉川ビル/
〒103-0022+東京都中央区日本橋室町３丁目２−１/
@35.6910283,139.7669607,16z/
data=!3m1!4b1!4m17!4m16
!1m5!1m1!1s0x60188c02f64e1cd9:0x987c1c7aa7e7f84a!2m2!1d139.7711379!2d35.6949994
!1m5!1m1!1s0x60188bffe47b594f:0xf5b2351645635f1e!2m2!1d139.772537!2d35.6879088
!2m3!6e1!7e2!8j1755338400
```

結果: 9:52出発 → 9:59到着（銀座線、7分、180円）

## エラーパターン

### ❌ 失敗例1: Place IDなし
```
/maps/dir/住所A/住所B/data=!3e3!5m2!6e1!8j1755338400
```
→ 時刻指定が効かない、モードが不安定

### ❌ 失敗例2: タイムスタンプ間違い
```
!8j1755306000  # JST考慮した値
```
→ 違う時刻として解釈される

### ❌ 失敗例3: 施設名での検索
```
/maps/dir/東京アメリカンクラブ
```
→ 麻布台の本店が選ばれる（日本橋店ではない）

## チェックリスト

URL作成時の確認事項：
- [ ] 郵便番号付きの完全な住所
- [ ] 両方のPlace ID
- [ ] 正確な座標
- [ ] !6e1!7e2!8j[timestamp]の順序
- [ ] タイムスタンプはUTC基準の時刻値
- [ ] 必要に応じて!3m1!4b1を追加

## まとめ

Google Maps URLの構築には：
1. **Place ID**が最重要（住所だけでは不十分）
2. **タイムスタンプ**はUTC基準の時刻値を使用
3. **住所検索**で正確な場所を特定（施設名は避ける）
4. **パラメータの順序**も重要