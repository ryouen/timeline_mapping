# 乗り換え徒歩時間の分析結果

## 調査日時: 2025-08-11

### 調査対象ルート
神田 → 神谷町（乗り換えあり）

### 実際のデータ構造

```
23:17 神田出発
  ↓ 徒歩: 約2分（61m）
23:19 淡路町駅発（丸ノ内線）
  ↓ 電車: 7分（4駅）
23:26 霞ケ関駅着
  ↓ 徒歩: 約1分（乗り換え）
  ↓ 待ち時間: 3分
23:30 霞ケ関駅発（日比谷線）
  ↓ 電車: 3分（2駅）
23:33 神谷町駅着
```

### 発見した問題点

1. **現在の誤認識パターン**
   - 霞ケ関での乗り換え時間: 4分（23:26→23:30）
   - 現在のコード: 全て徒歩時間として認識（5分など）
   - 実際: 徒歩1分 + 待ち時間3分

2. **Google Mapsの表示形式**
   - 徒歩時間は「約○分」として明確に表示
   - HTMLの構造:
     ```html
     <div class="wOBLed">
       <span>約 1 分</span>
     </div>
     ```

3. **時刻情報の位置**
   - 各セグメントの開始・終了時刻は別要素に格納
   - walk_textsの配列に「約○分」情報が含まれている

### 改善方針

1. **優先順位の設定**
   - 第1優先: 「約○分」のテキストを直接抽出
   - 第2優先: 時刻差から計算（ただし待ち時間を考慮）

2. **判定ロジック**
   - 乗り換え徒歩は通常1-3分
   - 5分以上の場合は待ち時間が含まれている可能性大

3. **実装方法**
   - class="wOBLed"内の「約○分」を確実に取得
   - セグメントタイプ（walk/train）と関連付け
   - 時刻情報との紐付けを改善

### テストケース

| ケース | 期待値 | 現在値 | 判定 |
|--------|--------|--------|------|
| 神田→淡路町（最初の徒歩） | 2分 | ? | 要確認 |
| 霞ケ関乗り換え（徒歩のみ） | 1分 | 5分 | ❌ |
| 霞ケ関乗り換え（待ち時間） | 3分 | 0分 | ❌ |

### 次のステップ

1. HTML解析ロジックの改善
2. 「約○分」テキストの確実な抽出
3. セグメント単位での正確な情報取得
4. 既存の動作を維持しながら段階的に改善