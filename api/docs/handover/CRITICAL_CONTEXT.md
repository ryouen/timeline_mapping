# ⚡ 重要なコンテキスト情報

## なぜこの問題が重要なのか

1. **ユーザーは実際にjson-generator.htmlを使用中**
   - 184物件のルート検索を実行
   - 3件のエラーで作業が中断
   - 結果のJSONファイルが不完全

2. **エラーの特殊性**
   - 184件中たった3件（1.6%）
   - すべて同じ物件（テラス月島801）
   - 他の物件は100%成功

## 問題の深い理解

### URLパラメータの罠

**現在のURL構造:**
```
https://www.google.com/maps/dir/[出発地]/[目的地]/data=!3m1!4b1!4m2!4m1!3e0
```

**問題の核心:**
- `!` マークが複数存在（!3m1, !4b1, !4m2, !4m1, !3e0）
- 住所「佃2丁目 22-3」の「22-3」部分
- Google Mapsが「!」を経由地の区切りとして解釈する可能性
- 結果: 「佃2丁目 22」→「3」→「目的地」という3地点ルートと誤解釈？

### なぜ他の物件は動くのか

**動作する例:**
- 佃2丁目 12-1 → 「12-1」は単純
- 神田須田町1-20-1 → 「丁目」を含まない
- 月島3丁目 12-4 → 数字の組み合わせが異なる

**パターン分析:**
- 「22-3」という特定の数字パターンが問題
- 「2」が多い（佃2丁目 22-3）
- パラメータの「!2」「!3」と混同される可能性

## 修正の本質

**修正前（問題あり）:**
```python
url += "data=!3m1!4b1!4m2!4m1!3e0"
```

**修正後（安全）:**
```python
url += "?travelmode=transit"
```

この変更により：
- `!` を含まない標準的なパラメータ形式
- Google Maps APIの公式推奨形式
- 住所との衝突リスクがゼロ

## 他に影響を受ける可能性のある物件

以下のパターンは要注意：
- 「○丁目 2△-3」（2と3を含む番地）
- 「○丁目 3△-2」（3と2を含む番地）
- 「○丁目 4△-1」（4と1を含む番地）

現在のproperties.jsonでは、テラス月島以外は問題なさそうだが、将来的に追加される物件で同様の問題が発生する可能性がある。

## 根本的な解決策

1. **即座の対応**: URLパラメータを安全な形式に変更
2. **中期的対応**: 住所の正規化処理を追加
3. **長期的対応**: Google Maps Places APIの使用を検討

## ユーザーへの影響

- **現在**: properties.jsonが不完全（181/184物件のみ）
- **修正後**: 完全なデータセットが生成可能
- **価値**: 物件選びの意思決定に必要な完全な情報

---
このコンテキストを理解することで、単なるバグ修正ではなく、ユーザーの実業務を支援する重要な作業であることが分かります。