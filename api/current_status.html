<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Scraper 現在の状況</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
            border-left: 4px solid #2196F3;
            padding-left: 10px;
        }
        .status-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .warning {
            color: #ff9800;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f0f0f0;
        }
        .code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .url {
            word-break: break-all;
            font-size: 0.85em;
            color: #666;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .timestamp {
            color: #999;
            font-size: 0.9em;
        }
        .debug-info {
            background: #fffbf0;
            border-left: 4px solid #ff9800;
            padding: 10px;
            margin: 10px 0;
        }
        .error-detail {
            background: #fff3e0;
            border-left: 4px solid #f44336;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.85em;
        }
        .important {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Google Maps Scraper 現在の状況</h1>
    <p class="timestamp">最終更新: 2025-08-17 06:25 JST</p>

    <div class="status-box">
        <h2>🚨 重大な発見</h2>
        <div class="error-detail">
<strong>問題1: タイムスタンプ計算が間違っていた</strong>
✅ 修正前: 1755511200 (UTCとして計算)
✅ 修正後: 1755478800 (JSTとして正しく計算)

<strong>問題2: 公共交通機関モード (!3e3) が効いていない</strong>
❌ 現在の結果: 車のルートが表示される（38分、33.2km、首都高速経由）
❌ 期待される結果: 電車のルート（JR中央線など）
        </div>
    </div>

    <div class="status-box">
        <h2>📝 ユーザーからの重要な助言</h2>
        <div class="debug-info">
            <h3>正しいURL構造の考え方</h3>
            <ol>
                <li><strong>Place IDで直接指定</strong> - 曖昧な「場所の名前」ではなく、世界に一つしかないユニークな「Place ID」を使う</li>
                <li><strong>到着時刻をUNIXタイムスタンプで指定</strong> - <code>!8j{timestamp}</code></li>
                <li><strong>正しいdata=ブロブ構造</strong>
                    <pre>!4m18!4m17                           // ヘッダー
!1m5!1m1!1s{出発地のPlace ID}        // 出発地ブロック
!1m5!1m1!1s{目的地のPlace ID}        // 目的地ブロック
!2m3!6e1!7e2!8j{タイムスタンプ}      // 時刻ブロック (!6e1=到着指定)
!3e3                                  // 公共交通機関モード</pre>
                </li>
            </ol>
        </div>
    </div>

    <div class="status-box">
        <h2>🔬 テスト結果</h2>
        
        <h3>1. 現在のURL構築（ユーザーの助言に基づく）</h3>
        <div class="url">
https://www.google.com/maps/dir/東京都千代田区神田須田町1-20-1/東京都府中市住吉町5-22-5/data=!4m18!4m17!1m5!1m1!1sChIJ2RxO9gKMGGARSvjnp3ocfJg!1m5!1m1!1sChIJR3AMl5nkGGARCqvDOHEMads!2m3!6e1!7e2!8j1755478800!3e3
        </div>
        
        <table>
            <tr>
                <th>要素</th>
                <th>値</th>
                <th>状態</th>
            </tr>
            <tr>
                <td>出発地Place ID</td>
                <td class="code">ChIJ2RxO9gKMGGARSvjnp3ocfJg</td>
                <td class="success">✅ ルフォンプログレ</td>
            </tr>
            <tr>
                <td>目的地Place ID</td>
                <td class="code">ChIJR3AMl5nkGGARCqvDOHEMads</td>
                <td class="success">✅ 府中オフィス</td>
            </tr>
            <tr>
                <td>タイムスタンプ</td>
                <td class="code">1755478800</td>
                <td class="success">✅ 2025-08-18 10:00 JST</td>
            </tr>
            <tr>
                <td>公共交通機関モード</td>
                <td class="code">!3e3</td>
                <td class="error">❌ 効いていない（車ルート表示）</td>
            </tr>
        </table>

        <h3>2. アクセス結果</h3>
        <div class="error-detail">
<strong>表示されたルート:</strong>
38分
33.2km
首都高速４号新宿線/ルート4 と 中央自動車道 経由
<span class="error">→ これは車のルート！電車ではない！</span>
        </div>

        <h3>3. 試したパラメータの配置</h3>
        <table>
            <tr>
                <th>配置パターン</th>
                <th>結果</th>
            </tr>
            <tr>
                <td><code>...!8j{timestamp}!3e3</code> (時刻の後)</td>
                <td class="error">❌ 車ルート</td>
            </tr>
            <tr>
                <td><code>...!3e3!8j{timestamp}</code> (時刻の前)</td>
                <td class="error">❌ 車ルート</td>
            </tr>
        </table>
    </div>

    <div class="status-box">
        <h2>🤔 次に試すべきこと</h2>
        <ol>
            <li><strong class="important">別のアプローチ</strong>: URLだけでなく、ページ読み込み後にJavaScriptで公共交通機関ボタンをクリック</li>
            <li><strong>パラメータの再確認</strong>: Google Maps APIドキュメントで正しいパラメータ形式を確認</li>
            <li><strong>順序の変更</strong>: data=ブロブ内の要素の順序を変更</li>
        </ol>
    </div>

    <div class="status-box">
        <h2>📂 保存ファイル</h2>
        <ul>
            <li><a href="timeout_debug.html">timeout_debug.html</a> - クリック後のHTML（937KB）</li>
            <li><a href="fuchu_test.html">fuchu_test.html</a> - Place ID直接アクセス時のHTML</li>
            <li><a href="fuchu_route_result.json">fuchu_route_result.json</a> - ルート取得結果</li>
        </ul>
    </div>
</body>
</html>